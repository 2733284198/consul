<StateChart @src={{this.chart}} @initial={{if (eq this.type 'oidc') 'provider' 'secret'}} as |State Guard Action dispatch state|>
  <Guard @name="isSecret" @cond={{action 'isSecret'}} />
  {{#let (concat '/' (or this.nspace 'default') '/' this.dc) as |path|}}
    <State @matches="secret">
      <DataSource
        @src={{concat path '/token/self/' this.value}}
        @onchange={{action 'change'}}
        @onerror={{action this.onerror}}
      />
    </State>
    <State @matches="provider">
      <DataSource
        @src={{concat path '/oidc/provider/' this.value}}
        @onchange={{queue (action (mut this.provider) value="data") (action dispatch "SUCCESS")}}
        @onerror={{action this.onerror}}
      />
    </State>
    <State @matches="jwt">
      <JwtSource
        @src={{this.provider.AuthURL}}
        @onchange={{queue (action (mut this.jwt) value="data") (action dispatch "SUCCESS")}}
        @onerror={{action this.onerror}}
      />
    </State>
    <State @matches="token">
      <DataSource
        @src={{concat path '/oidc/authorize/' this.provider.Name '/' this.jwt.authorizationCode '/' this.jwt.authorizationState}}
        @onchange={{action 'change'}}
        @onerror={{action this.onerror}}
      />
    </State>
  {{/let}}
</StateChart>