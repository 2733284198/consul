<div
  ...attributes
  class="consul-intention-permission-form"
>
  {{yield (hash
    submit=(action 'submit' this.changeset)
    reset=(action 'reset' this.changeset)
    isDirty=(and this.changeset.isValid)
    changeset=this.changeset
  )}}

  <fieldset>
    <span class="label">
      Should this permission allow the source connect to the destination?
    </span>
    <div role="radiogroup" class={{if this.changeset.error.Action ' has-error'}}>
      {{#each this.intents as |intent|}}
        <label>
          <span>{{capitalize intent}}</span>
          <input
            type="radio"
            name="Action"
            value={{intent}}
            checked={{if (eq this.changeset.Action intent) 'checked'}}
            onchange={{action (changeset-set this.changeset 'Action') value="target.value"}}
          />
        </label>
      {{/each}}
    </div>
  </fieldset>

  <fieldset>
    <header>
      <h2>Path</h2>
    </header>
    <div>
      <label class="type-select">
        <span>Path Type</span>
        <PowerSelect
          @options={{this.pathTypes}}
          @selected={{this.pathType}}
          @onChange={{action 'change' 'HTTP.PathType' this.changeset}} as |Type|>
            {{get this.pathLabels Type}}
        </PowerSelect>
      </label>
{{#if this.shouldShowPathField}}
      <label class="type-text{{if this.changeset.error.HTTP.Path ' has-error'}}">
        <span>{{get this.pathLabels this.pathType}}</span>
        <input
          type="text"
          name="Path"
          value={{changeset-get this.changeset 'HTTP.Path'}}
          oninput={{action 'change' 'HTTP.Path' this.changeset}}
        />
        {{#if this.changeset.error.HTTP.Path}}
          <strong>
            {{#if (eq (changeset-get this.changeset 'HTTP.PathType') 'PathRegex')}}
              Path Regex should not be blank
            {{else}}
              Path should begin with a '/'
            {{/if}}
          </strong>
        {{/if}}
      </label>
{{/if}}
    </div>
  </fieldset>

  <fieldset>
    <h2>Methods</h2>
    <div class="type-toggle">
      <span>All methods are applied by default unless specified</span>
      <label class="type-checkbox">
        <input
          type="checkbox"
          name="{{this.name}}[allMethods]"
          checked={{if this.allMethods 'checked'}}
          onchange={{action 'change' 'allMethods' this.changeset}}
        />
        <span>All methods</span>
      </label>
    </div>

{{#if this.shouldShowMethods}}
    <div class="checkbox-group" role="group">
      {{#each this.methods as |method|}}
        <label class="type-checkbox">
          <input
            type="checkbox"
            name="method"
            value={{method}}
            checked={{if (contains method this.changeset.HTTP.Methods) 'checked'}}
            onchange={{action 'change' 'method' this.changeset}}
          />
          <span>{{method}}</span>
        </label>
      {{/each}}
    </div>
{{/if}}
  </fieldset>

  <fieldset>
    <h2>Headers</h2>
    <ConsulIntentionPermissionHeaderList
      @items={{changeset-get this.changeset 'HTTP.Header'}}
      @ondelete={{action 'delete' 'HTTP.Header' this.changeset}}
    as |headerList|>

    </ConsulIntentionPermissionHeaderList>

    <ConsulIntentionPermissionHeaderForm
      @onsubmit={{action 'add' 'HTTP.Header' this.changeset}}
    as |headerForm|>
      <Ref @target={{this}} @name="headerForm" @value={{headerForm}} />
    </ConsulIntentionPermissionHeaderForm>

    <button
      type="button"
      class="type-submit"
      disabled={{if (not this.headerForm.isDirty) 'disabled'}}
      onclick={{action this.headerForm.submit}}
    >
      Add another header
    </button>
    <button
      type="button"
      class="type-cancel"
      onclick={{action this.headerForm.reset}}
    >
      Cancel
    </button>

  </fieldset>
</div>