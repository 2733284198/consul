<form>
  <PolicyForm @form={{form}} @nspace={{this.nspace}} @item={{this.item}}>
    {{!don't show template selection here, i.e. Service Identity}}
    <BlockSlot @name="template" />
  </PolicyForm>
{{#if (not this.create) }}
  <TokenList @caption="Applied to the following tokens:" @items={{this.items}} />
{{/if}}
    <div>
{{#if this.create }}
        {{! we only need to check for an empty name here as ember munges autofocus, once we have autofocus back revisit this}}
        <button type="submit" {{ action "create" this.item}} disabled={{if (or this.item.isPristine this.item.isInvalid (eq this.item.Name '')) 'disabled'}}>Save</button>
{{ else }}
        <button type="submit" {{ action "update" this.item}} disabled={{if this.item.isInvalid 'disabled'}}>Save</button>
{{/if}}
        <button type="reset" {{ action "cancel" this.item}}>Cancel</button>
{{# if (not this.create) }}
        <ConfirmationDialog @message="Are you sure you want to delete this Policy?">
            <BlockSlot @name="action" as |confirm|>
                <button type="button" data-test-delete class="type-delete" {{action confirm 'delete' this.item}}>Delete</button>
            </BlockSlot>
            <BlockSlot @name="dialog" as |execute cancel message|>
    {{#if (gt this.items.length 0)}}
              <ModalDialog
                data-test-delete-modal
                @onclose={{action cancel}}
              >
                  <BlockSlot @name="header">
                      <h2>Policy in Use</h2>
                  </BlockSlot>
                  <BlockSlot @name="body">
                    <p>
                      This Policy is currently in use. If you choose to delete this Policy, it will be removed from the following <strong>{{this.items.length}} Tokens</strong>:
                    </p>
                    <TokenList @items={{this.items}} @target="_blank" />
                    <p>
                      This action cannot be undone. {{message}}
                    </p>
                  </BlockSlot>
                  <BlockSlot @name="actions" as |close|>
                    <button type="button" class="type-delete" {{action execute}}>Yes, Delete</button>
                    <button type="button" class="type-cancel" {{action close}}>Cancel</button>
                  </BlockSlot>
              </ModalDialog>
    {{else}}
                <DeleteConfirmation @message={{message}} @execute={{execute}} @cancel={{cancel}} />
    {{/if}}
            </BlockSlot>
        </ConfirmationDialog>
{{/if}}
    </div>
</form>
